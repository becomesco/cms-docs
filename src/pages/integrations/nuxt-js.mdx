export const sections = [
  { title: 'Starting from scratch', id: 'starting-a-project-from-scratch' },
  {
    title: 'Adding BCMS to existing project',
    id: 'adding-bcms-to-an-existing-nuxt-project',
  },
  {
    title: 'Getting data from BCMS',
    id: 'getting-data-from-bcms-in-a-nuxt-page',
  },
  {
    title: 'BCMSImage Component',
    id: 'working-with-bcms-image-component',
  },
]

# Getting started with Nuxt.js and BCMS

This is the Nuxt.js plugin documentation for the BCMS.

## Starting a project from scratch

If you are starting a Nuxt.js project from scratch, and want to connect it with BCMS, You can initialize Nuxt project by using the [BCMS CLI](/cli).
Through an interactive terminal questionary, BCMS cli will set it up for you.

To install BCMS CLI globally, run `npm install -g @becomes/cms-cli`. After that, you should be able to create a Nuxt project and connect it with BCMS by running: `bcms --website create`. Here you can read more about [BCMS CLI](/cli). If you want to add BCMS to an existing Nuxt project, that's described [here]().

## Adding BCMS to an existing Nuxt project

Developers usualy start Nuxt.js & BCMS with [BCMS CLI](/cli) projects by running `bcms --website create`, like described above. If you want to add BCMS to an existing Nuxt.js project, follow along.

First you'll need to install the BCMS Nuxt.js plugin by running `nuxt-plugin-bcms`. After that, add this code to your `nuxt.config.js` modules section:

<CodeGroup>
```javascript
modules: [
  ...
  [
    'nuxt-plugin-bcms',
    createBcmsNuxtConfig({
      cms: {
        origin: process.env.BCMS_API_ORIGIN /** your BCMS_API_ORIGIN */,
        key: {
          id:  process.env.BCMS_API_KEY /** your BCMS_API_KEY */,
          secret:  process.env.BCMS_API_SECRET /** your BCMS_API_SECRET */
        },
      },
      websiteDomain: process.env.ORIGIN || 'http://localhost:3000',
      media: {
        download: false,
      },
    }),
  ],
]
```
</CodeGroup>

## Getting data from BCMS in a Nuxt page

There are two ways how you can get data in Nuxt page.

The first is by using BCMS Client methods, available in Nuxt context with the name **$bcms**. The other way is by making API calls to the Nuxt middleware, by using **$bcms.request( ... )**. Depending on how complex your use case is, you'll chose the simpler on more complex one.

### Getting data in a Nuxt.js page using BCMS Client

If you want to get an entry from Blog template, and the entry's slug is _'how-to-connect-bcms-and-nuxtjs'_, all you have to do is:

<CodeGroup>
  ```typescript {{ title: 'Nuxt.js 3' }}
  const { data } = useAsyncData(async (ctx) => {
    const blog = (await ctx?.$bcms.entry.get({
      template: 'blog',
      entry: 'how-to-connect-bcms-and-nuxtjs',
    })) as HomeEntry[];
    return { blog }
  });
  ```
</CodeGroup>

For this particular use case, you will probably put this code in your `blog/_slug.vue` file, and set entry parameter to be dynamic, like this: `entry: ctx.route.params.slug`. After that, your blog's data is available in the `blog` variable.

{/* TODO: The rest of the available $bcms options */}

### Getting data using Nuxt middleware API

When using BCMS with Nuxt middleware API, you don't call BCMS API endpoints every time you need something from the CMS. Instead, Nuxt middleware caches the reponse data in RAM, prividing fast response time and more flexibility. Here's how to set it up:

Create a `bcms.routes.ts` file. Inside, let's create a simple configuration and and an endpoint which will return list of all templates.

<CodeGroup>
  ```typescript
import { createBcmsMostServerRoutes, createBcmsMostServerRoute } from '@becomes/cms-most';

export default createBcmsMostServerRoutes({
    '/template-list.json': createBcmsMostServerRoute({
      method: 'get',
      async handler({ bcms }) {
        await bcms.template.pull();
        const result = await bcms.template.find(async () => true);
        return result.map((temp) => {
          return {
            title: temp.label,
            slug: '/' + temp.name,
          };
        });
      },
    }),
});
````
</CodeGroup>

In the example above, we quickly created an endpoint that returns a light model of all templates from the BCMS instance, containing only the *title* and *slug* properties of each template.

You can now call this endpoint inside of *asyncData*, as shown bellow:

<CodeGroup>
```typescript
const { data } = useAsyncData(async (ctx) => {
  const result = await ctx?.$bcms.request<Array<{ title: string; slug: string }>>({
    url: '/template-list.json',
  });
  return result;
});
````

</CodeGroup>

## Working with BCMSImage Nuxt.js component

We all love images on the web. High-quality, sharp ones. But we also love fast websites. Why can't we have both? Well, BCMS Image lets you have both. To simplify handling responsive images and performance optimization, we created the `BCMSImage` component.

It automatically creates multiple variants of the source image, including WEBP format. Let's see how to use it. Our demo blog data (which is available if you are [running BCMS locally](/install/locally)), has a cover image property. To start, let's import the `BCMSImage` component and pass the cover_image object.

<CodeGroup>
```html
<template>
  <div v-if="blog">
    <div v-if="blog.meta.en && blog.meta.en.cover_image">
      <BCMSImage :media="blog.meta.en.cover_image" />
    </div>
  </div>
</template>
<script lang="ts">
  import BCMSImage from 'nuxt-plugin-bcms/components/image.vue';
  export default Vue.extend({
    components: {
      BCMSImage,
    },
  });
</script>
````
</CodeGroup>

In your browser, you'll see that the image size is changing. The real image source is changing. If you inspect the image, you'll see that the image source is of the same size as it appears on the screen. BCMSImage takes care of chosing the perfect image dimensions, out of the box.
You are also able to pass to it options like quality and sizes, that will give you a fine grained control over performance and art direction.

Learn more about all BCMSImage component options here.
